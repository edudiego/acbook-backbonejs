<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Node.js - Lecture 2</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.scrollzer.min.js"></script>
		<script src="js/jquery.scrolly.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
		</noscript>

		<style>
			.ac-caption {
				margin: 5px 0px 10px 0px;
				font-size: 13px;
  				text-align: center;
			}

			#header > nav ul li a {
				padding: 0px;
				font-size: 0.8em;
			}

			#one:before {
				background-image: none;
				height: 0em;
			}

			header.major h2 {
				line-height: 1em;
			}
		</style>

		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
	<body>
		<div id="wrapper">

			<!-- Header -->
			<section id="header" class="skel-layers-fixed">
				<header>
					<h1 id="logo"><a href="#">Node.js - Lecture 2</a></h1>
				</header>
				<nav id="nav">
					<ul>
						<li><a href="#one" class="active">Introduction</a></li>
						<li><a href="#two">Concepts Recap</a></li>
						<li><a href="#three">Hello World With Express</a></li>
						<li><a href="#four">Exercises</a></li>
					</ul>
					<img src="http://www.avenuecode.com/wp-content/themes/ac-site/images/white-logo.png" alt="">
				</nav>
				<footer>
				</footer>
			</section>

			<!-- Main -->
			<div id="main">

				<!-- One -->
				<section id="one">
					<div class="container">
						<header class="major">
							<h2>Introduction</h2>
						</header>

						<p align="justify">
              Express is a web application framework for Node.js. It's minimal, flexible and great for building Web APIs.
            </p>

            <p align="justify">
              We can build any kind of server-side application that we want, however, remember that we talked about how
              low level is Node? So Express give us one layer of abstraction. We can define routes and controllers easily,
              and it give us the power to add validations and custom code, using everything that Node give to us.
            </p>

					</div>
				</section>

				<!-- Two -->
				<section id="two">
					<div class="container">
            <header class="major">
              <h2>Concepts Recap</h2>
            </header>

            <header class="major">
              <h4>URL</h4>
            </header>

            <p align="justify">
              Before we start I would like to recap some HTTP basics. First, lets talk about URL. Each part of the URL
              represents an information to the server that it's important to define what it should do and execute. Here
              we explain some of the info that an URL can have.
            </p>

						<span class="image fit">
							<img style="width: 80%; margin: 0 auto;" src="images/http-url.jpg" alt="HTTP URL"/>
						</span>
            <div class="ac-caption">HTTP url eplained</div>

						<ul>
							<li>
                <p align="justify">
                  <b>Protocol: </b>the protocol determines how the request will be transmitted. We will be dealing
                  exclusively with http and https.
                </p>
							</li>
							<li>
                <p align="justify">
                  <b>Host: </b>the host identifies the server. Servers on your computer (localhost) or a local network
                  may be simply one word, or it may be a numeric IP address. On the internet, the host will end in a
                  top-level domain, like .com or .net.
                </p>
							</li>
							<li>
                <p align="justify">
                  <b>Port: </b>each server has a collection of numbered ports. Some port numbers are "special", like 80
                  and 443. If you omit the port, port 80 is assumed for HTTP and 443 for HTTPS. In general if aren't using
                  one of those, you should use a port number greater than 1023.
                </p>
							</li>
							<li>
                <p align="justify">
                  <b>Path: </b>the path is generally the first part of the URL that your app cares about. The path should
                  be used to uniquely identify pages or other resources in your app.
                </p>
							</li>
							<li>
                <p align="justify">
                  <b>Query string: </b>the query string is an optional collection of name/value pairs. The querystring
                  starts with a question mark (?), and name/value pairs are separated by "&".
                </p>
							</li>
							<li>
                <p align="justify">
                  <b>Fragment: </b>The fragment (or hash) is not passed to the server at all. It is strictly for use by
                  the browser. It's becoming very common for single-page applications to use it.
                </p>
							</li>
						</ul>

            <header class="major">
              <h4>HTTP</h4>
            </header>

            <p align="justify">
              <i>
                "HTTP (Hypertext Transfer Protocol) is an aplpication protocol for distributed, collaborative, hypermedia
                information systems."
              </i>
              <span style="float: right">- Wikipedia</span>
            </p>

            <p align="justify">
              It is just a protocol. A pretty important one, since this is the protocol that we use to surf on the web.
              Why do we have to know this protocol? Simple, we need to know which kind of responses this protocol have, so
              any client that connect to our server can understand all of our server's responses. Fortunately we have a
              <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">cheat sheet</a> for that. The most important
              ones are:
            </p>

            <ul>
              <li><b>200:</b> Successful request;</li>
              <li><b>201:</b> The request has been fulfilled and resulted in a new resource being created;</li>
              <li><b>400:</b> The request could not be understood. Malformed syntax;</li>
              <li><b>401:</b> The request requires an authenticated user;</li>
              <li><b>403:</b> The server understood the request, but refused to fulfill it;</li>
              <li><b>404:</b> Most famous code. The server could not found the page requested.</li>
            </ul>

            <p aling="justify">
              Now that we know each kind of responses we can understand how our clients can make their calls. We have
              eight different types of request that are defined <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">here</a>.
              However, for now, we have to know just 4:
            </p>

            <ul>
              <li><b>GET:</b> retrieve whatever information that was requested;</li>
              <li><b>POST:</b> sends an entity enclosed in the request. Used to send information;</li>
              <li><b>PUT:</b> sends an entity enclosed in the request to be stored by the server. Used to update information;</li>
              <li><b>DELETE:</b> request the server to delete the resource identified by the request.</li>
            </ul>

            <p align="justify">
              We still have <b>OPTIONS</b>, <b>HEAD</b>, <b>TRACE</b> and <b>CONNECT</b>, but we will try not to use them
              for this classes, but it is good to know that they exist.
            </p>

					</div>
				</section>

				<!-- Three -->
				<section id="three">
					<div class="container">
            <header class="major">
              <h2>Hello World with Express</h2>
            </header>

            <header class="major">
              <h4>Lifting a Server</h4>
            </header>

            <p align="justify">
              Alright gentlemen, and lady, now it is the time! We will learn what you all came here for! Express!
            </p>

            <p align="justify">
              First things first. Lets install this bad boy:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #d0d0d0">$</span> <span style="color: #d0d0d0">npm</span> <span style="color: #d0d0d0">install</span> <span style="color: #d0d0d0">express</span>
</pre></div>
            <div class="ac-caption">Installing Express Package</div>

            <p align="justify">
              Sweet! No more talk! Here is some <b>CODE</b>:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">express</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;express&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">app</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">express();</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #d0d0d0">response.send(</span><span style="color: #ed9d13">&#39;I\&#39;m alive!&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.listen(</span><span style="color: #3677a9">8080</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(){</span>
  <span style="color: #d0d0d0">console.log(</span><span style="color: #ed9d13">&#39;Listening on port 8080...&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>
</pre></div>
            <div class="ac-caption">Simple HTTP server with Express</div>

            <header class="major">
              <h4>Express Request and Responses</h4>
            </header>

            <p align="justify">
              Neat, hun? Easy to read, simple and small. We can see events handlers being configured! This is the same
              behavior that we saw at <a href="/acbook-nodejs/lecture1.html#five">Lecture 1: Node Server</a>.
              Hey, hold on! Where is the <b>end()</b> event being called? Where are we writing the <b>200</b> status?
              Express technomagically does that for us. Nevertheless, if you want you can do this by yourself:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">express</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;express&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">app</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">express();</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #d0d0d0">response.status(</span><span style="color: #3677a9">200</span><span style="color: #d0d0d0">).send(</span><span style="color: #ed9d13">&#39;I\&#39;m alive!&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.listen(</span><span style="color: #3677a9">8080</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(){</span>
  <span style="color: #d0d0d0">console.log(</span><span style="color: #ed9d13">&#39;Listening on port 8080...&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>
</pre></div>
            <div class="ac-caption">Setting Status For Yourself</div>

            <p align="justify">
              We can send objects too. They will be stringfied and sent to the requester:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">express</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;express&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">app</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">express();</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #d0d0d0">response.status(</span><span style="color: #3677a9">200</span><span style="color: #d0d0d0">).json({msg:</span> <span style="color: #ed9d13">&#39;I\&#39;m alive!&#39;</span><span style="color: #d0d0d0">});</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.listen(</span><span style="color: #3677a9">8080</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(){</span>
  <span style="color: #d0d0d0">console.log(</span><span style="color: #ed9d13">&#39;Listening on port 8080...&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>
</pre></div>
            <div class="ac-caption">Sending an Object</div>

            <p align="justify">
              Easy. So basically we created a server that only receives a <b>GET</b> request and returns a message. But
              we can be more fancy. What about read some query string from the request?
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">express</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;express&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">app</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">express();</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">msgStrings</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;First String&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;Second String&#39;</span><span style="color: #d0d0d0">];</span>
  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">messageIndex</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">request.query.index;</span>
  <span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(messageIndex</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">messageIndex</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">msgStrings.length)</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">response.send(msgStrings[messageIndex]);</span>
  <span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">response.sendStatus(</span><span style="color: #3677a9">403</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">}</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.listen(</span><span style="color: #3677a9">8080</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(){</span>
  <span style="color: #d0d0d0">console.log(</span><span style="color: #ed9d13">&#39;Listening on port 8080...&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>
</pre></div>

            <div class="ac-caption">Retrieving Query String Data</div>

            <p align="justify">
              Easy-peasy. Express process the request for us before it reaches our code using something called
              <b>middlewares</b>. This way he can prepare the request object to be easy to use. We will talk about
              <b>middlewares</b> in another time. Now lets focus on what we can do for responses and routing.
            </p>

            <header class="major">
              <h4>Routing</h4>
            </header>

            <p align="justify">
              We didn't had much fun yet. Now, with Express, we can create a more useful server. Lets keep using the
              <i>GET</i> request type. How about define a server that plays with our old friend <b>brian</b>, remember him?
              Our dog from <a href=/acbook-nodejs/lecture1.html#five">Lecture 1: Lim Po Kim</a>.
              But this time we will change the Dog class a little bit:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">Dog</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(name)</span> <span style="color: #d0d0d0">{</span>

  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">name;</span>

  <span style="color: #6ab825; font-weight: bold">this</span><span style="color: #d0d0d0">.whoIsAGoodBoy</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">()</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39; is a good boy!&#39;</span><span style="color: #d0d0d0">;</span>
  <span style="color: #d0d0d0">};</span>

  <span style="color: #6ab825; font-weight: bold">this</span><span style="color: #d0d0d0">.wiggle</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">()</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">_name</span> <span style="color: #d0d0d0">+</span> <span style="color: #ed9d13">&#39; is wiggling.&#39;</span><span style="color: #d0d0d0">;</span>
  <span style="color: #d0d0d0">};</span>

  <span style="color: #6ab825; font-weight: bold">this</span><span style="color: #d0d0d0">.getName</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">()</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #d0d0d0">_name;</span>
  <span style="color: #d0d0d0">};</span>

  <span style="color: #6ab825; font-weight: bold">this</span><span style="color: #d0d0d0">.setName</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(newName)</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">_name</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">newName;</span>
  <span style="color: #d0d0d0">}</span>

<span style="color: #d0d0d0">}</span>

<span style="color: #d0d0d0">module.exports</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Dog;</span>
</pre></div>
            <div class="ac-caption">New Dog Class</div>

            <p align="justfy">
              With this brand new Dog class we can create different routes in our server.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">express</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;express&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">Dog</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;./Dog&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">app</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">express();</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">brian</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">Dog(</span><span style="color: #ed9d13">&#39;Brian&#39;</span><span style="color: #d0d0d0">);</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/goodDog&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #d0d0d0">response.send(brian.whoIsAGoodBoy());</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/wiggle&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #d0d0d0">response.send(brian.wiggle());</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.listen(</span><span style="color: #3677a9">8080</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(){</span>
  <span style="color: #d0d0d0">console.log(</span><span style="color: #ed9d13">&#39;Listening on port 8080...&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>
</pre></div>
            <div class="ac-caption">Adding New Route To Our Server</div>

            <p align="justify">
              With this setup we have a server hosted at <b><i>localhost:8080</i></b> that have two routes:
            </p>

            <ul>
              <li><b>localhost:8080/goodDog:</b> that will return who is a good dog;</li>
              <li><b>localhost:8080/wiggle:</b> that will wiggle our dog's tail.</li>
            </ul>

            <p align="justify">
              Brian is in fact a good dog! He is such a good dog that we decided to give him a bride! And they lived happily
              ever after! So happy that they had puppies! Now it is too difficult to ask who is a good dog and which one
              we should expect to wiggle its tail. But fear not! Express will help us out here. We can define dynamic
              routing.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">express</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;express&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">Dog</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;./Dog&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">app</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">express();</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">dogs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[</span>
  <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">Dog(</span><span style="color: #ed9d13">&#39;Brian&#39;</span><span style="color: #d0d0d0">),</span>
  <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">Dog(</span><span style="color: #ed9d13">&#39;Tina Turner&#39;</span><span style="color: #d0d0d0">),</span>
  <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">Dog(</span><span style="color: #ed9d13">&#39;Puppy 1&#39;</span><span style="color: #d0d0d0">),</span>
  <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">Dog(</span><span style="color: #ed9d13">&#39;Puppy 2&#39;</span><span style="color: #d0d0d0">),</span>
  <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">Dog(</span><span style="color: #ed9d13">&#39;Puppy 3&#39;</span><span style="color: #d0d0d0">)</span>
<span style="color: #d0d0d0">];</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/goodDog/:doggyId&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">doggyIndex</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">request.params.doggyId;</span>
  <span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(doggyIndex</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">doggyIndex</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">dogs.length)</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">response.send(dogs[doggyIndex].whoIsAGoodBoy());</span>
  <span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">response.sendStatus(</span><span style="color: #3677a9">403</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">}</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.get(</span><span style="color: #ed9d13">&#39;/wiggle/:doggyId&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response)</span> <span style="color: #d0d0d0">{</span>
  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">doggyIndex</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">request.params.doggyId;</span>
  <span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(doggyIndex</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">doggyIndex</span> <span style="color: #d0d0d0">&lt;</span> <span style="color: #d0d0d0">dogs.length)</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">response.send(dogs[doggyIndex].wiggle());</span>
  <span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">response.sendStatus(</span><span style="color: #3677a9">403</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">}</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.listen(</span><span style="color: #3677a9">8080</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(){</span>
  <span style="color: #d0d0d0">console.log(</span><span style="color: #ed9d13">&#39;Listening on port 8080...&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>
</pre></div>
            <div class="ac-caption">Dynamic Routing</div>

            <p align="justify">
              With this setup we have the following URLs now:
            </p>

            <ul>
              <li><b>localhost:8080/goodDog/_doggyId_:</b> Where <i>_doggyId_</i> could be replaced by a number like
                <i>localhost:8080/goodDog/2</i>. This will make puppy 1 says that he is the good dog;</li>
              <li><b>localhost:8080/wiggle/_doggyId_:</b> Where <i>_doggyId_</i> could be replaced by a number like
                <i>localhost:8080/wiggle/0</i>. This will make Brian wiggle his tail.</li>
            </ul>

            <p align="justify">
              Now we can easily see which dog is a good dog and who wiggle its tails! Nicely done. Now that we are good
              with the results lets try to use <b>POST</b> requests. This is a little tricky because Express makes it difficult
              to get the <b>POST</b>'s data. We need NPM to the rescue! Lets install a module that will parse all the data
              for us!
            </p>

            <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #d0d0d0">$</span> <span style="color: #d0d0d0">npm</span> <span style="color: #d0d0d0">install</span> <span style="color: #d0d0d0">body-parser</span>
</pre></div>
            <div class="ac-caption">Installing Body-Parser</div>

            <p align="justify">
              Now, lets use this package. I still do not want to tell you guys what a <b>middleware</b> is, so hang tight!
              Just assume that this will solve our problems.
            </p>

            <!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">express</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;express&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">Dog</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;./Dog&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">bodyParser</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">require(</span><span style="color: #ed9d13">&#39;body-parser&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">parseUrlencoded</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">bodyParser.urlencoded({extend:</span> <span style="color: #6ab825; font-weight: bold">false</span><span style="color: #d0d0d0">});</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">app</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">express();</span>
<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">dogs</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">[...];</span>

<span style="color: #999999; font-style: italic">//app.get()...</span>

<span style="color: #d0d0d0">app.post(</span><span style="color: #ed9d13">&#39;/dog&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">parseUrlencoded,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response){</span>
  <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">data</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">request.body;</span>
  <span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(data){</span>
    <span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">newDog</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">Dog(data.name);</span>

    <span style="color: #d0d0d0">dogs.push(newDog);</span>

    <span style="color: #d0d0d0">response.status(</span><span style="color: #3677a9">201</span><span style="color: #d0d0d0">).send(</span><span style="color: #ed9d13">&#39;Dog added! Brian loved it.&#39;</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">response.sendStatus(</span><span style="color: #3677a9">403</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">}</span>
<span style="color: #d0d0d0">});</span>

<span style="color: #d0d0d0">app.listen(</span><span style="color: #3677a9">8080</span><span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(){</span>
  <span style="color: #d0d0d0">console.log(</span><span style="color: #ed9d13">&#39;Listening on port 8080...&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">});</span>
</pre></div>
            <div class="ac-caption">Post Request</div>

            <p align="justify">
              One use of the package <i>Body-Parser</i> is to get the data that was encoded to be transmitted and parse it
              to an usable object. It makes the attribute <i>resquest.body</i> available to us. Normally this body data
              comes from a HTML form or an ajax call.
            </p>

            <p align="justify">
              We can say that the methods <b>PUT</b> and <b>DELETE</b> will take the same implementation as <b>POST</b>
              and <b>GET</b>, the only difference will be which method to call on your app. Lets take a look how those
              two would be implemented them.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #d0d0d0">...</span>

<span style="color: #d0d0d0">app.put(</span><span style="color: #ed9d13">&#39;/dog&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">parseUrlencoded,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response){...});</span>

<span style="color: #d0d0d0">app.</span><span style="color: #6ab825; font-weight: bold">delete</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;/dog/:doggyId&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">parseUrlencoded,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response){...});</span>

<span style="color: #d0d0d0">...</span>
</pre></div>
            <div class="ac-caption">Put and Delete Routes</div>

            <p align="justify">
              Wait a minute! I have seen one of those routes before! The <b>PUT</b> method have the same path as the <b>POST</b>
              method. It is the same declaration. I think we can fix that. Our Express application has a object named Route.
              With it we can define our routes in other way.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #d0d0d0">...</span>

<span style="color: #6ab825; font-weight: bold">var</span> <span style="color: #d0d0d0">dogRoute</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">app.route(</span><span style="color: #ed9d13">&#39;/dog&#39;</span><span style="color: #d0d0d0">);</span>
<span style="color: #d0d0d0">dogRoute.post(parseUrlencoded,</span><span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response){...})</span>
<span style="color: #d0d0d0">dogRoute.put(parseUrlencoded,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response){...})</span>

<span style="color: #d0d0d0">...</span>
</pre></div>
            <div class="ac-caption">Using Route Object</div>

            <p align="justify">
              Hhhmmm.... Still not good. We are using the variable <i>dogRoute</i> too many times. Imagine if we have all
              method types related to this route? No, we should have a better way! In fact, we have.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #d0d0d0">...</span>

<span style="color: #d0d0d0">app.route(</span><span style="color: #ed9d13">&#39;/dog&#39;</span><span style="color: #d0d0d0">);</span>
  <span style="color: #d0d0d0">.post(parseUrlencoded,</span><span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response){...})</span>
  <span style="color: #d0d0d0">.put(parseUrlencoded,</span> <span style="color: #6ab825; font-weight: bold">function</span><span style="color: #d0d0d0">(request,</span> <span style="color: #d0d0d0">response){...})</span>

<span style="color: #d0d0d0">...</span>
</pre></div>
            <div class="ac-caption">Chaining Route Calls</div>

            <p align="justify">
              That is how I like it! One less variable! Clean code! Smells like vicotry!
            </p>
          </div>
				</section>

        <!-- Four -->
        <section id="four">
          <div class="container">
            <header class="major">
              <h2>Exercises</h2>
            </header>

            <header class="major">
              <h4>Instructions</h4>
            </header>

            <p align="justify">
              To start this exercises, please clone <a href="https://github.com/andrebot/Lecture2-NodeExpressAC">this</a> repository's master branch.
            </p>

            <header>
              <h4>Exercise 1:</h4>
            </header>

            <p align="justify">
              Create a Express server that respond with 'Hello World' if I try to reach it.
            </p>

            <header>
              <h4>Exercise 2:</h4>
            </header>

            <p align="justify">
              Using the same server from <i>Exercise 1</i> change the <b>GET</b> route to return the user's list. This route
              should expect a query string that can come empty or not. This query string should be named <b>"q"</b> and will be
              used to search users by name. If there is no query string you should return the whole list.
            </p>

            <header>
              <h4>Exercise 3:</h4>
            </header>

            <p align="justify">
              Using the same server from <i>Exercise 1</i> create a <b>POST</b> route that creates a user. The data will
              come from a form action. You should validate you data, it should exist. If it does not the request should fail.
              This route's path should be <i>"localhost:3000/users"</i>
            </p>

            <header>
              <h4>Exercise 4:</h4>
            </header>

            <p align="justify">
              Using the same server from <i>Exercise 1</i> create a <b>GET</b> dynamic route that get an user by ID. This
              ID will be captured by the path's variable. In case that the user does not exist, return and empty object.
              This route's path should be <i>"localhost:3000/users/:userId"</i>
            </p>

            <header>
              <h4>Exercise 5:</h4>
            </header>

            <p align="justify">
              Using the same server from <i>Exercise 1</i> create a <b>DELETE</b> dynamic route that delete an user by ID. This
              ID will be captured by the path's variable. This route's path should be <i>"localhost:3000/users/:userId"</i>
            </p>

            <header>
              <h4>Exercise 6:</h4>
            </header>

            <p align="justify">
              Using the same server from <i>Exercise 1</i> create a <b>PUT</b> dynamic route that change an user password by ID.
              This ID will be captured by the path's variable. The data will come from a form action. You should validate
              that, if there is missing any data, the request should fail.This route's path should be <i>"localhost:3000/users/password/:userId"</i>
            </p>

            <header>
              <h4>Exercise 7:</h4>
            </header>

            <p align="justify">
              Refactor your code to clean it up. Use <b>Route</b> to couple methods that have the same path.
            </p>
          </div>
        </section>

			</div>

      <!-- Footer -->
      <section id="footer">
        <div class="container">
          <ul class="copyright">
            <li>&copy; Avenue Code. All rights reserved.</li>
            <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
          </ul>
        </div>
      </section>

		</div>
	</body>
</html>