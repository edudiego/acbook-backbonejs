<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Node.js - Lecture 3</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.scrollzer.min.js"></script>
		<script src="js/jquery.scrolly.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
		</noscript>

		<style>
			.ac-caption {
				margin: 5px 0px 10px 0px;
				font-size: 13px;
  				text-align: center;
			}

			#header > nav ul li a {
				padding: 0px;
				font-size: 0.8em;
			}

			#one:before {
				background-image: none;
				height: 0em;
			}

			header.major h2 {
				line-height: 1em;
			}
		</style>

		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
	<body>
		<div id="wrapper">

      <!-- Header -->
      <section id="header" class="skel-layers-fixed">
        <header>
          <h1 id="logo"><a href="#">Node.js - Lecture 3</a></h1>
        </header>
        <nav id="nav">
          <ul>
            <li><a href="#one" class="active">Middleware</a></li>
            <li><a href="#two">Project Scaffolding</a></li>
            <li><a href="#three">Exercises</a></li>
          </ul>
          <img src="http://www.avenuecode.com/wp-content/themes/ac-site/images/white-logo.png" alt="">
        </nav>
        <footer>
        </footer>
      </section>

			<!-- Main -->
      <div id="main">

        <!-- One -->
        <section id="one">
          <div class="container">
            <header class="major">
              <h2>Middleware</h2>
            </header>

            <header>
              <h4>What it is</h4>
            </header>

            <p align="justify">
              Today I'm willing to talk about middleware. Now you guys are ready to deal with this beauty. Basically
              Express is a series of middleware calls.
            </p>

            <p align="justify">
              <i>
                Middleware is a function with access to the request object, the response object, and the next
                middleware in the application’s request-response cycle, commonly denoted by a variable named next.
              </i>
              <p align="right">- Express Documentation</p>
            </p>

            <p align="justify">
              What it means is that a middleware can parse, validate and modify data that comes from the requester before
              it reaches the route's callback. It can also redirect and end a request whenever it feels like it. it is very
              important that any middleware added call the next middleware, otherwise we will leave the request hanging.
            </p>

            <p align="justify">
              Now we can understand what that Body-Parser package was doing! It was actually adding a middleware to
              be executed before our route, formatting the data and appending it to the request object. Interesting.
            </p>

            <span class="image fit">
                <img src="images/middleware.png" alt="Middleware Diagram"/>
              </span>
            <div class="ac-caption">Middleware Diagram</div>

            <header>
              <h4>Serving Static Files</h4>
            </header>

            <p align="justify">
              Now that we know what a middleware is (FINALLY!!) we can serve static files. This is how Node/Express
              becomes a content server. Express makes it easy to do this.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">app</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">();</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">express</span><span style="color: #f8f8f2">.</span><span style="color: #66d9ef">static</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;public&#39;</span><span style="color: #f8f8f2">));</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listen</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8080</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
  <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Listening on port 8080...&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
            <div class="ac-caption">Making a Folder Public</div>

            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <pre style="margin: 0; line-height: 125%">
                  <span style="color: #d0d0d0">└── nodeCode</span>
                  <span style="color: #d0d0d0">    ├── index.js</span>
                  <span style="color: #d0d0d0">    └── public</span>
                  <span style="color: #d0d0d0">        └── ...</span>
                </pre>
            </div>
            <div class="ac-caption">Folder Structure</div>

            <p align="justify">
              With this setup we can access every content inside the public folder by hitting: <b>http://localhost:8080/</b>.
              It is possible to create a "virtual" path prefix too, since the path does not actually exists in the file system.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">app</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">();</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;static&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">.</span><span style="color: #66d9ef">static</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;public&#39;</span><span style="color: #f8f8f2">));</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listen</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8080</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
  <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Listening on port 8080...&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
            <div class="ac-caption">Adding a Path Prefix</div>

            <p align="justify">
              Doing like this we access this folder by <b>http://localhost:8080/static/</b>. So, if I have something
              like this:
            </p>

            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <pre style="margin: 0; line-height: 125%">
                  <span style="color: #d0d0d0">└── nodeCode</span>
                  <span style="color: #d0d0d0">    ├── index.js</span>
                  <span style="color: #d0d0d0">    └── public</span>
                  <span style="color: #d0d0d0">        ├── css</span>
                  <span style="color: #d0d0d0">        │   └── materialDesign.css</span>
                  <span style="color: #d0d0d0">        ├── js</span>
                  <span style="color: #d0d0d0">        │   └── angular-v3.0.1.min.css</span>
                  <span style="color: #d0d0d0">        └── index.html</span>
                </pre>
            </div>
            <div class="ac-caption">Public Folder Structure</div>

            <p align="justify">
              We would access those files respectively:
            </p>

            <ul>
              <li>http://localhost:8080/static/css/materialDesign.css</li>
              <li>http://localhost:8080/static/js/angular-v3.0.1.min.css</li>
              <li>http://localhost:8080/static/index.html</li>
            </ul>

            <p align="justify">
              You can define multiple files:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">app</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">();</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">express</span><span style="color: #f8f8f2">.</span><span style="color: #66d9ef">static</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;public&#39;</span><span style="color: #f8f8f2">));</span>
<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">express</span><span style="color: #f8f8f2">.</span><span style="color: #66d9ef">static</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;files&#39;</span><span style="color: #f8f8f2">));</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listen</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8080</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
  <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Listening on port 8080...&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
            <div class="ac-caption">Multiple Files Being Served</div>

            <p align="justify">
              Our only concern about this multiple files serving is that the files would be looked up in the order the
              static folders were set.
            </p>

            <p align="justify">
              It is possible to configure which files and folders that we want to become public, and that is a good
              thing.
            </p>

            <header>
              <h4>Our First Middleware</h4>
            </header>

            <p align="justify">
              What we know about Express's middleware:
            </p>

            <ul>
              <li>Express is basically a bunch of them being executed;</li>
              <li>They are executed in oder of addition (A queue);</li>
              <li>We can access response and request objects inside its functions;</li>
              <li>A middleware <b style="font-size: 30px;">MUST</b> call the next middleware.</li>
            </ul>

            <p align="justify">
              To keep it simple as this lecture, we are going to build a middleware that prints the time that request
              takes to be completed.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">app</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">();</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">next</span><span style="color: #f8f8f2">){</span>
  <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">start</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Date();</span>
  <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">url</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">url</span><span style="color: #f8f8f2">;</span>
  <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">method</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">method</span><span style="color: #f8f8f2">;</span>

  <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">on</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;finish&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">duration</span> <span style="color: #f92672">=</span> <span style="color: #f92672">+</span><span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Date()</span> <span style="color: #f92672">-</span> <span style="color: #a6e22e">start</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">message</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">method</span> <span style="color: #f92672">+</span><span style="color: #e6db74">&#39; to &#39;</span><span style="color: #f92672">+</span> <span style="color: #a6e22e">url</span> <span style="color: #f92672">+</span><span style="color: #e6db74">&#39;\ntook &#39;</span><span style="color: #f92672">+</span> <span style="color: #a6e22e">duration</span> <span style="color: #f92672">+</span><span style="color: #e6db74">&#39; ms \n\n&#39;</span><span style="color: #f8f8f2">;</span>
    <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">message</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">});</span>

  <span style="color: #a6e22e">next</span><span style="color: #f8f8f2">();</span>
<span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listen</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8080</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
  <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Listening on port 8080...&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>
</pre></div>

            <div class="ac-caption">Time Middleware</div>

            <p align="justify">
              Great! Now, for every request that reaches our server we can know how much time it took! It feels great
              to know Middleware! You must have a tick behind your ear asking: Ok, you said that Express is middleware
              behind middlewatre, prove it! I'm more than happy to do so.
            </p>

            <p align="justify">
              Remember our last example at <a href="/acbook-nodejs/lecture2.html">Lecture 2: Hello World With Express</a>
              where we define all the routes for the Dog Service? Well, here we have it:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">Dog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./Dog&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">bodyParser</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;body-parser&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">parseUrlencoded</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">bodyParser</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">urlencoded</span><span style="color: #f8f8f2">({</span><span style="color: #a6e22e">extend</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">false</span><span style="color: #f8f8f2">});</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">app</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">();</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dogs</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[</span>
  <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Dog</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Brian&#39;</span><span style="color: #f8f8f2">),</span>
  <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Dog</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Tina Turner&#39;</span><span style="color: #f8f8f2">),</span>
  <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Dog</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Puppy 1&#39;</span><span style="color: #f8f8f2">),</span>
  <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Dog</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Puppy 2&#39;</span><span style="color: #f8f8f2">),</span>
  <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Dog</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Puppy 3&#39;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">];</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">post</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">parseUrlencoded</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">data</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">newDog</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Dog</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">name</span><span style="color: #f8f8f2">);</span>

    <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">push</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">newDog</span><span style="color: #f8f8f2">);</span>

    <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">status</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">201</span><span style="color: #f8f8f2">).</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Dog added! Brian loved it.&#39;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">})</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">put</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">parseUrlencoded</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">for</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">x</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">length</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">;</span> <span style="color: #a6e22e">x</span> <span style="color: #f92672">&gt;=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #a6e22e">x</span><span style="color: #f92672">--</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">x</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">getName</span><span style="color: #f8f8f2">()</span> <span style="color: #f92672">===</span> <span style="color: #a6e22e">dog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">name</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">x</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">setName</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">newName</span><span style="color: #f8f8f2">);</span>
      <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>

    <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">sendStatus</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">200</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog/:doggyId&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #66d9ef">delete</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">parseUrlencoded</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">doggyId</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">params</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">;</span>

    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">splice</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">];</span>

    <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">json</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dog</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/goodDog/:doggyId&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">params</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&amp;&amp;</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&lt;</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">length</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">doggyIndex</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">whoIsAGoodBoy</span><span style="color: #f8f8f2">());</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/wiggle/:doggyId&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">params</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&amp;&amp;</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&lt;</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">length</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">doggyIndex</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">wiggle</span><span style="color: #f8f8f2">());</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listen</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8080</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
  <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Listening on port 8080...&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
            <div class="ac-caption">Full Dog Service Code</div>

            <p align="justify">
              I will make it thinner, removing this ugly routes definitions in our bootstrap code. I can read your minds,
              you are all: "But how André?", simple my friend! <b>MIDDLEWARE</b>! First I will create a folder to hold
              our routes. We have to pay attention that we have three endpoints:
            </p>

            <ul>
              <li>http://localhost:8080/dog</li>
              <li>http://localhost:8080/goodDog</li>
              <li>http://localhost:8080/wiggle</li>
            </ul>

            <p align="justify">
              So I will create 3 files to hold each route:
            </p>

            <ul>
              <li>dogRoute.js</li>
              <li>goodDogRoute.js</li>
              <li>wiggleRoute.js</li>
            </ul>

            <p align="justify">
              Lets go to the <i>dogRoute.js</i> file:
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">bodyParser</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;body-parser&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">parseUrlencoded</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">bodyParser</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">urlencoded</span><span style="color: #f8f8f2">({</span><span style="color: #a6e22e">extend</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">false</span><span style="color: #f8f8f2">});</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">router</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Router</span><span style="color: #f8f8f2">();</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dogs</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./dogs&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">Dog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./Dog&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">post</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">parseUrlencoded</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">data</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">newDog</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #a6e22e">Dog</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">data</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">name</span><span style="color: #f8f8f2">);</span>

    <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">push</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">newDog</span><span style="color: #f8f8f2">);</span>

    <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">status</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">201</span><span style="color: #f8f8f2">).</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Dog added! Brian loved it.&#39;</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">})</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">put</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">parseUrlencoded</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">body</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">for</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">x</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">length</span> <span style="color: #f92672">-</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">;</span> <span style="color: #a6e22e">x</span> <span style="color: #f92672">&gt;=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">;</span> <span style="color: #a6e22e">x</span><span style="color: #f92672">--</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">x</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">getName</span><span style="color: #f8f8f2">()</span> <span style="color: #f92672">===</span> <span style="color: #a6e22e">dog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">name</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">x</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">setName</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dog</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">newName</span><span style="color: #f8f8f2">);</span>
      <span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">}</span>

    <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">sendStatus</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">200</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/:doggyId&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #66d9ef">delete</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">parseUrlencoded</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">){</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">doggyId</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">params</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">;</span>

    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dog</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">splice</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)[</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">];</span>

    <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">json</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dog</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">module</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">exports</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">router</span><span style="color: #f8f8f2">;</span>
</pre></div>

            <div class="ac-caption">Dog Routes</div>

            <p align="justify">
              It is easy to identify that I've removed the <i>'dog'</i> word from the route. That is ok, I will get there.
              The <i>router</i> object will give me the ability to create routes. So I'm defining inside this <i>router</i>
              variable all the <b>relative</b> paths for each method that I want to map and then exporting it. <i>wiggle.js</i>
              and <i>goodDog.js</i> will have the same structure.
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">router</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Router</span><span style="color: #f8f8f2">();</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dogs</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./dogs&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/:doggyId&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">params</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&amp;&amp;</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&lt;</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">length</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">doggyIndex</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">whoIsAGoodBoy</span><span style="color: #f8f8f2">());</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">module</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">eports</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">router</span><span style="color: #f8f8f2">;</span>
</pre></div>
            <div class="ac-caption">Good Dog Route</div>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">router</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Router</span><span style="color: #f8f8f2">();</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dogs</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./dogs&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/:doggyId&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">request</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #66d9ef">var</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">request</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">params</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">doggyId</span><span style="color: #f8f8f2">;</span>
    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&amp;&amp;</span> <span style="color: #a6e22e">doggyIndex</span> <span style="color: #f92672">&lt;</span> <span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">length</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
      <span style="color: #a6e22e">response</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">send</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">dogs</span><span style="color: #f8f8f2">[</span><span style="color: #a6e22e">doggyIndex</span><span style="color: #f8f8f2">].</span><span style="color: #a6e22e">wiggle</span><span style="color: #f8f8f2">());</span>
    <span style="color: #f8f8f2">}</span>
  <span style="color: #f8f8f2">});</span>

<span style="color: #a6e22e">module</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">eports</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">router</span><span style="color: #f8f8f2">;</span>
</pre></div>
            <div class="ac-caption">Wiggle Route</div>

            <p align="justify">
              Nothing on my right hand....nothing on my left hand....TA-DA!
            </p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">express</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;express&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">app</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">express</span><span style="color: #f8f8f2">();</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">dogRoute</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./dogRoute&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">goodDogRoute</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./goodDogRoute&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">wiggleRoute</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">require</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;./wiggleRoute&#39;</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/dog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">dogRoute</span><span style="color: #f8f8f2">);</span>
<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/goodDog&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">goodDogRoute</span><span style="color: #f8f8f2">);</span>
<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">use</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/wiggle&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">wiggleRoute</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">app</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listen</span><span style="color: #f8f8f2">(</span><span style="color: #ae81ff">8080</span><span style="color: #f8f8f2">,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(){</span>
  <span style="color: #a6e22e">console</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">log</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;Listening on port 8080...&#39;</span><span style="color: #f8f8f2">);</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
            <div class="ac-caption">Index.js Refactored</div>

            <p align="justify">
              Remember when I said about relative path in the <i>express.static</i> middleware? We can do the same thing
              here, but now we are defining a common prefix for each route!
            </p>
          </div>
        </section>

        <!-- Two -->
        <section id="two">
          <div class="container">
            <header class="major">
              <h2>Project Scaffolding</h2>
            </header>

            <header class="major">
              <h4>What is Scaffolding?</h4>
            </header>

            <p align="justify">
              We have several definitions for scaffolding, but for us scaffolding will mean:
            </p>

            <p align="justify">
              <i>
                Is the first folder structure defined for a project. It can follow any kind of standard or pattern
                that best fits the project's needs.
              </i>
              <p align="right">- Almeida, André</p>
            </p>

            <p align="justify">
              As Node.js is a runtime environment, there is no standard structure defined for it. The same goes for Express,
              there isn't anything pre-defined, that means that we can go nuts! Ok, not like that, but we are free to
              do whatever our project need.
            </p>

            <p align="justify">
              We've seen in <a href="/acbook-nodejs/lecture1.html#three">Lecture 1: Code Import, Using Require</a> that
              Node give us the power to import any code into any file using <b>require()</b>. Which means that we can
              scatter our code all over the place and them glue them together using imports.
            </p>

            <p align="justify">
              We've just saw that it is possible to make any folder visible to the internet using the middleware
              <b>express.static()</b>. With this we can even decouple our frontend from the backend. We still have some
              awesome tools, like <b><a href="http://gruntjs.com/">Grunt</a></b>, that allow us to modularize even more
              our sweet code. We even got NPM to manage our packages! So I can say that we are in a comfortable situation.
            </p>

            <p align="justify">
              When we are facing this kind of problem, I mean, defining a folder structure, we should be asking some
              questions:
            </p>

            <ul>
              <li>What kind of application I'm building?</li>
              <li>Do we have a standard folder structure for that already?</li>
              <li>How can I organize my code so I can minimize the code conflicts in merges?</li>
              <li>How can I organize my code so I can work with few open folders in my sidebar?</li>
              <li>Which kind of name should I give my folders so I can make it easy to find what I want?</li>
            </ul>

            <p align="justify">
              For some of us, thinking about how we can organize our files is not that hard, because we came from a
              developer background which gives us the knowledge of how things can be connected and some folder
              patterns that we used in the past.
            </p>

            <p align="justify">
              To prove you that I am not lying: I bet that more than half of you that are reading this knows what MVC is.
              Got you, didn't I? MVC is one of the most popular folder structure in a <b>server project</b>. The reason
              is that MVC have well defined rules and concepts about how a server should work and behave, so most of the
              developers find it warming working in a workspace that they already know. Just because we are using a
              bad-ass-awesome-kick-ass-new technology does not mean that we have to throw away all the cool stuff that
              the community already gave to us.
            </p>

            <p align="justify">
              Bottom line? If you are building a MVC application you will create an MVC structure.
            </p>

            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <pre style="margin: 0; line-height: 125%">
                  <span style="color: #d0d0d0">└── nodeCode</span>
                  <span style="color: #d0d0d0">    ├── Controllers</span>
                  <span style="color: #d0d0d0">    │   ├── userController.js</span>
                  <span style="color: #d0d0d0">    │   ├── friendsController.js</span>
                  <span style="color: #d0d0d0">    │   └── postController.js</span>
                  <span style="color: #d0d0d0">    ├── Model</span>
                  <span style="color: #d0d0d0">    │   ├── friendsDAO.js</span>
                  <span style="color: #d0d0d0">    │   ├── postDAO.js</span>
                  <span style="color: #d0d0d0">    │   └── userDAO.js</span>
                  <span style="color: #d0d0d0">    ├── View</span>
                  <span style="color: #d0d0d0">    │   ├── css/</span>
                  <span style="color: #d0d0d0">    │   ├── js/</span>
                  <span style="color: #d0d0d0">    │   ├── friendList.html</span>
                  <span style="color: #d0d0d0">    │   ├── index.html</span>
                  <span style="color: #d0d0d0">    │   └── login.html</span>
                  <span style="color: #d0d0d0">    ├── Routes</span>
                  <span style="color: #d0d0d0">    │   ├── friends.route.js</span>
                  <span style="color: #d0d0d0">    │   ├── index.route.js</span>
                  <span style="color: #d0d0d0">    │   └── login.route.js</span>
                  <span style="color: #d0d0d0">    └── server.js</span>
                </pre>
            </div>
            <div class="ac-caption">MVC Folder Structure</div>

            <p align="justify">
              Or you can build a structure from your head, thinking about coupling concerns
            </p>

            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <pre style="margin: 0; line-height: 125%">
                  <span style="color: #d0d0d0">└── nodeCode</span>
                  <span style="color: #d0d0d0">    ├── Auth</span>
                  <span style="color: #d0d0d0">    │   └── authorization.js</span>
                  <span style="color: #d0d0d0">    ├── Persistent</span>
                  <span style="color: #d0d0d0">    │   ├── friendsDAO.js</span>
                  <span style="color: #d0d0d0">    │   ├── postDAO.js</span>
                  <span style="color: #d0d0d0">    │   └── userDAO.js</span>
                  <span style="color: #d0d0d0">    ├── Routes</span>
                  <span style="color: #d0d0d0">    │   ├── friendship</span>
                  <span style="color: #d0d0d0">    │   │   ├── friendshipController.js</span>
                  <span style="color: #d0d0d0">    │   │   └── friendshipRouting.js</span>
                  <span style="color: #d0d0d0">    │   ├── login</span>
                  <span style="color: #d0d0d0">    │   │   ├── loginController.js</span>
                  <span style="color: #d0d0d0">    │   │   └── loginRouting.js</span>
                  <span style="color: #d0d0d0">    │   └── users</span>
                  <span style="color: #d0d0d0">    │       ├── userController.js</span>
                  <span style="color: #d0d0d0">    │       └── userRouting.js</span>
                  <span style="color: #d0d0d0">    ├── Schema</span>
                  <span style="color: #d0d0d0">    │   ├── friendship.schema.js</span>
                  <span style="color: #d0d0d0">    │   └── user.schema.js</span>
                  <span style="color: #d0d0d0">    ├── config.js</span>
                  <span style="color: #d0d0d0">    └── index.js</span>
                </pre>
            </div>
            <div class="ac-caption">Concerns Folder Structure</div>

            <p align="justify">
              There is no right way to do it. There is the best way to solve your needs/problems. You always have to
              think if it is easy to understand where to find your code and if this is really organizing everything.
            </p>

            <p align="justify">
              But we are talking about server application. We can build desktop applications too. Lets take a look into
              Popcorn Time folder structure:
            </p>

            <div style="background: #202020; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <pre style="margin: 0; line-height: 125%">
                  <span style="color: #d0d0d0">└── src/app</span>
                  <span style="color: #d0d0d0">    ├── css</span>
                  <span style="color: #d0d0d0">    │   ├── animation.css</span>
                  <span style="color: #d0d0d0">    │   └── font-awesome.min.css</span>
                  <span style="color: #d0d0d0">    ├── fonts</span>
                  <span style="color: #d0d0d0">    │   ├── OpenSansBold.svg</span>
                  <span style="color: #d0d0d0">    │   ├── OpdenSans-Blod.woff</span>
                  <span style="color: #d0d0d0">    │   └── ...</span>
                  <span style="color: #d0d0d0">    ├── images</span>
                  <span style="color: #d0d0d0">    │   └── ...</span>
                  <span style="color: #d0d0d0">    ├── lib</span>
                  <span style="color: #d0d0d0">    │   ├── cache.js</span>
                  <span style="color: #d0d0d0">    │   └── ...</span>
                  <span style="color: #d0d0d0">    ├── styl</span>
                  <span style="color: #d0d0d0">    │   ├── Official_-_Black_&_Yellow_theme.styl</span>
                  <span style="color: #d0d0d0">    │   └── ..</span>
                  <span style="color: #d0d0d0">    ├── templates</span>
                  <span style="color: #d0d0d0">    │   ├── about.tpl</span>
                  <span style="color: #d0d0d0">    │   └── ...</span>
                  <span style="color: #d0d0d0">    ├── vendor</span>
                  <span style="color: #d0d0d0">    │   ├── videojshooks.js</span>
                  <span style="color: #d0d0d0">    │   └── videojsplugins.js</span>
                  <span style="color: #d0d0d0">    ├── .jshintrc</span>
                  <span style="color: #d0d0d0">    ├── app.js</span>
                  <span style="color: #d0d0d0">    ├── bootstrap.js</span>
                  <span style="color: #d0d0d0">    ├── common.js</span>
                  <span style="color: #d0d0d0">    ├── database.js</span>
                  <span style="color: #d0d0d0">    ├── httpapi.js</span>
                  <span style="color: #d0d0d0">    ├── index.html</span>
                  <span style="color: #d0d0d0">    ├── language.js</span>
                  <span style="color: #d0d0d0">    ├── settings.js</span>
                  <span style="color: #d0d0d0">    ├── updater.js</span>
                  <span style="color: #d0d0d0">    └── vpn.js</span>
                </pre>
            </div>
            <div class="ac-caption">Popcorn Time Folder Structure</div>

            <p align="justify">
              Lets use our well know patterns! Lets couple concerns! Lets decouple layers! Lets make it beautiful!
              Lets make it readable!
            </p>

            </div>
          </section>

        <!-- Three -->
        <section id="three">
          <div class="container">
            <header class="major">
              <h2>Exercises</h2>
            </header>

            <p align="justify">
              I've created another branch named <b>Lecture 3</b> in the <a href="https://github.com/andrebot/Lecture2-NodeExpressAC">same repository</a>
              that we used in <a href="/acbook-nodejs/lecture2.html#four">Lecture 2: Exercises</a>. Please move all the
              code that you did in the master branch and move it to this new branch.
            </p>

            <header>
              <h1>Exercise 1:</h1>
            </header>

            <p align="justify">
              Using the server created at <a href="/acbook-nodejs/lecture2.html#four">Lesson 2: Exercises</a> install
              the package <i>body-parser</i> and add two middleware to parse url encoded data and json data.
            </p>

            <header>
              <h1>Exercise 2:</h1>
            </header>

            <p align="justify">
              Using the same code created at Exercise 1 make the folder <i>public</i> available to be reached by <a>http://localhost:3000</a>.
            </p>

            <header>
              <h1>Exercise 3:</h1>
            </header>

            <p align="justify">
              Using the same code created at Exercise 2 create a config file that will hold the server configurations:
              host, port, appName.
            </p>

            <header>
              <h1>Exercise 4:</h1>
            </header>

            <p align="justify">
              <b>CHALLENGE:</b> Using the same code created at Exercise 3 create a middleware which will be triggered before
              every request that searches for a cookie in the request with the appName defined at the config file create
              in the last exercise and print its contents on the console.
            </p>

            <header>
              <h1>Exercise 5:</h1>
            </header>

            <p align="justify">
              Using the same code created at Exercise 4 decouple your routes definitions from the index.js into another file
              and import it back to index.js and use it as a middleware to define your routes again.
            </p>

            <header>
              <h1>Exercise 6:</h1>
            </header>

            <p align="justify">
              Using the same code created at Exercise 4 move the cookie middleware into its own folder. Do the same with
              the file created at Exercise 5 to hold the routes. And again with <i>userDAO</i> and <i>user.schema.js</i>,
              put them into separate folders. Name those files the way you find it is best.
            </p>

            <header>
              <h1>Exercise 7:</h1>
            </header>

            <p align="justify">
              Are you IDLE? Ask me for more challenges.
            </p>
          </div>
        </section>

      </div>

      <!-- Footer -->
      <section id="footer">
        <div class="container">
          <ul class="copyright">
            <li>&copy; Avenue Code. All rights reserved.</li>
            <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
          </ul>
        </div>
      </section>
    </div>
	</body>
</html>