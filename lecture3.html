<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
	<title>Backbone.js - Lecture 3</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery.scrollzer.min.js"></script>
	<script src="js/jquery.scrolly.min.js"></script>
	<script src="js/skel.min.js"></script>
	<script src="js/skel-layers.min.js"></script>
	<script src="js/init.js"></script>

	<noscript>
		<link rel="stylesheet" href="css/skel.css" />
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" href="css/style-xlarge.css" />
	</noscript>

	<style>
	.ac-caption {
		margin: 5px 0px 10px 0px;
		font-size: 13px;
		text-align: center;
	}

	#header > nav ul li a {
		padding: 0px;
		font-size: 0.8em;
	}

	#one:before {
		background-image: none;
		height: 0em;
	}

	header.major h2 {
		line-height: 1em;
	}
	</style>

	<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
</head>
<body>
	<div id="wrapper">

		<!-- Header -->
		<section id="header" class="skel-layers-fixed">
			<header>

				<h1 id="logo"><a href="#">Backbone - Lecture 3</a></h1>

			</header>
			<nav id="nav">
				<ul>
					<li><a href="#one" class="active">Collections</a></li>
					<li><a href="#two">Views + Collections</a></li>
					<li><a href="#three">The Social Network</a></li>
				</ul>
				<img src="http://www.avenuecode.com/wp-content/themes/ac-site/images/white-logo.png" alt="">
			</nav>
			<footer>
			</footer>
		</section>

		<!-- Main -->
		<div id="main">

			<div class="container">
				<img class="logo-big" src="./images/backbone.png">
			</div>

			<!-- One -->
			<section id="one">
				<div class="container">

					<header class="major">
						<h2>Collections</h2>
					</header>

					<p align="justify">
						Collections are <b>ordered sets of models</b>. You can bind <b>"change"</b> events to be notified when any model in the collection has been modified, listen for <b>"add"</b> and <b>"remove"</b> events, <b>fetch</b> the collection from the server, and use a full suite of Underscore.js methods.
					</p>

					<p align="justify">
						Any event that is triggered on a model in a collection will also be triggered on the collection directly, for convenience. This allows you to listen for changes to specific attributes in any model in a collection, for example: <b>documents.on("change:selected", ...)</b>.
					</p>

					<img src="./images/backbone-events.png">
					<div class="ac-caption">Some Models events reflect on the Collection it belongs to.</div>

					<header>
						<h4>Collection Methods</h4>
					</header>

					<p align="justify">
						By its "array-like" nature, the <b>Collection</b> is compatible with the <b>Underscore.js</b> library and so inherits a total of 46 functional methods from it. You can see the whole list <a href="http://backbonejs.org/#Collection-Underscore-Methods">here</a>.
					</p>

					<p align="justify">
						Apart from that methods, a few of the most commonly used <b>Collections</b> methods include:
					</p>

					<ul>
						<li><b>add</b></li>
						<li><b>create</b></li>
						<li><b>remove</b></li>
						<li><b>set</b></li>
						<li><b>get</b></li>
						<li><b>reset</b></li>
						<li><b>comparator</b></li>
						<li><b>at</b></li>
						<li><b>slice</b></li>
						<li><b>parse</b></li>
						<li><b>where</b></li>
						<li><b>pluck</b></li>
						<li><b>push</b></li>
						<li><b>pop</b></li>						
					</ul>

					<p align="justify">
						We will see some of these methods in further detail on this lecture.
					</p>

					<header>
						<h4>Collection Events</h4>
					</header>

					<p align="justify">
						Collections share some of its <b>events</b> with the Models, but they also have some events that are exclusive to them. Below we have the list of built-in events that can be fired by Collections and sometimes also by Models:
					</p>

					<ul>
						<li><b>"add"</b> (model, collection, options) — when a model is added to a collection.</li>
						<li><b>"remove"</b> (model, collection, options) — when a model is removed from a collection.</li>
						<li><b>"update"</b> (collection, options) — single event triggered after any number of models have been added or removed from a collection.</li>
						<li><b>"reset"</b> (collection, options) — when the collection's entire contents have been replaced.</li>
						<li><b>"sort"</b> (collection, options) — when the collection has been re-sorted.</li>
						<li><b>"change"</b> (model, options) — when a model's attributes have changed.</li>
						<li><b>"change:[attribute]"</b> (model, value, options) — when a specific attribute has been updated.</li>
						<li><b>"destroy"</b> (model, collection, options) — when a model is <a href="#Model-destroy">destroyed</a>.</li>
						<li><b>"request"</b> (model_or_collection, xhr, options) — when a model or collection has started a request to the server.</li>
						<li><b>"sync"</b> (model_or_collection, resp, options) — when a model or collection has been successfully synced with the server.</li>
						<li><b>"error"</b> (model_or_collection, resp, options) — when a model's or collection's request to the server has failed.</li>
						<li><b>"invalid"</b> (model, error, options) — when a model's validation fails on the client.</li>
						<li><b>"all"</b> — this special event fires for <i>any</i> triggered event, passing the event name as the first argument.</li>
					</ul>

					<header>
						<h4>The Collection "model" attribute</h4>
					</header>

					<p align="justify">
						The Collection <b>model</b> attribute specifies which kind of model the Collection will hold (don't you say?). When we determine this attribute, we can pass raw attributes objects (and arrays) to the Collection's <b>add</b>, <b>create</b> and <b>reset</b> methods and the attributes will be converted into a model of the proper type.
					</p>

<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">Library</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">Backbone</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Collection</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">extend</span><span style="color: #f8f8f2">({</span>
    <span style="color: #a6e22e">model</span><span style="color: #f92672">:</span> <span style="color: #a6e22e">Book</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
<div class="ac-caption">A Collection with a Model type definition.</div>


					<ul class="feature-icons">
						<li class="fa-bolt" style="width: inherit">
							Notice how, diffferent from the <b>View</b> model, the <b>Collection</b> model refers to a Model <b>definition</b> rather than to a model <b>instance</b>.
						</li>
					</ul>

					<header>
						<h4>The Collection models</h4>
					</header>

					<p align="justify">
						The Collection <b>models</b> is a raw access to the JavaScript array of models inside the collection. Usually you will want to use <b>get</b> and <b>at</b> to get the model instances, or the <b>Underscore</b> methods to do so.
					</p>

					<header>
						<h4>The Collection comparator() Method</h4>
					</header>

					<p align="justify">
						By default there is no <b>comparator</b> for a collection. If you define a comparator, it will be used to maintain the collection in sorted order. This means that as models are added, they are inserted at the correct index in <b>collection.models</b>. 
					</p>
					<p align="justify">
						A comparator can be defined as a <b>sortBy</b> (pass a function that takes a single argument), as a <b>sort</b> (pass a comparator function that expects two arguments), or as a string indicating the attribute to sort by.
					</p>

					<header>
						<h4>The Collection url or url()</h4>
					</header>

					<p align="justify">
						Set the <b>url</b> property (or function) on a collection to reference its location on the server. Models within the collection will use url to construct URLs of their own.	
					</p>

<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">Notes</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">Backbone</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Collection</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">extend</span><span style="color: #f8f8f2">({</span>
    <span style="color: #a6e22e">url</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;/notes&#39;</span>
<span style="color: #f8f8f2">});</span>

<span style="color: #75715e">// Or, something more sophisticated:</span>

<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">Notes</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">Backbone</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Collection</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">extend</span><span style="color: #f8f8f2">({</span>
    <span style="color: #a6e22e">url</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">()</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">return</span> <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.document.</span><span style="color: #a6e22e">url</span><span style="color: #f8f8f2">()</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;/notes&#39;</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
					<div class="ac-caption">A Collection <b>url</b> can be either a string or a function.</div>

					<header>
						<h4>The Collection sync() Method</h4>
					</header>

					<p align="justify">
						Uses <b>Backbone.sync</b> to persist the state of a collection to the server. Can be overridden for custom behavior.
					</p>


					<img src="./images/backbone-collection.png">
					<div class="ac-caption">A Collection sync() method ilustrated.</div>

					<header>
						<h4>Exercise 9</h4>
					</header>

					<p align="justify">
						Start your server by running <b>grunt serverExpress</b>. Login to the social network API going to <b>localthost:3000/login.html</b>. After logged in, open the <b>exercise9.html</b> file on the main project folder. 
					</p>
					<p align="justify">	
						From now on as the code will grow larger, create a separate script file named <b>socialnetwork.js</b> and save it on the project's scripts folder (<b>public/assets/js</b>). Link the script file at the end of your document and follow the instructions below:
					</p>

					<ol>
						<li>Copy the code from your previous exercise, so that your script already have the <b>ProfileView</b> and the <b>EditProfileView</b> running and working with the <b>Router</b>.</li>						
						<li>Create a collection with the url property: <b>/users/available</b>. Issue a <b>fetch()</b> and log the results on the console.</li>
						<li></li>
						<li></li>
						<li></li>
					</ol>

				</div>
			</section>
			
			<section id="two">
				<div class="container">
					<header class="major">
						<h2>Views + Collections</h2>
					</header>
					
					<p align="justify">
						Backbone <b>Views</b> listens to the <b>Collections</b> events the same way it does for <b>Models</b>. They key difference between the combination Views + Collections and the View + Model is on the <b>render</b> method implementation.
					</p>

					<p align="justify">
						Usually for rendering a Collection, the View will optionally <b>filter</b > the contents to be shown and then <b>iterate</b> on the selected elements from the collection and append them one by one on its DOM element.
					</p>

					<p align="justify">
						This is far from optimized and the main reason for the creation of the <b>Marionette.js</b> library. Marionette main goal is to provide a better way for Backbone Views to render Collections and other composite data structures, besides avoiding memory leaks caused by <b>ghost views</b>.
					</p>



				</div>
			</section>
		</div>

		<!-- Footer -->
		<section id="footer">
			<div class="container">
				<ul class="copyright">
					<li>&copy; Avenue Code. All rights reserved.</li>
					<li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
				</ul>
			</div>
		</section>

	</div>
</body>
</html>