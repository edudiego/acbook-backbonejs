<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
	<title>Backbone.js - Lecture 4</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery.scrollzer.min.js"></script>
	<script src="js/jquery.scrolly.min.js"></script>
	<script src="js/skel.min.js"></script>
	<script src="js/skel-layers.min.js"></script>
	<script src="js/init.js"></script>

	<noscript>
		<link rel="stylesheet" href="css/skel.css" />
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" href="css/style-xlarge.css" />
	</noscript>

	<style>
	.ac-caption {
		margin: 5px 0px 10px 0px;
		font-size: 13px;
		text-align: center;
	}

	#header > nav ul li a {
		padding: 0px;
		font-size: 0.8em;
	}

	#one:before {
		background-image: none;
		height: 0em;
	}

	header.major h2 {
		line-height: 1em;
	}
	</style>

	<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
</head>
<body>
	<div id="wrapper">

		<!-- Header -->
		<section id="header" class="skel-layers-fixed">
			<header>

				<h1 id="logo"><a href="#">Backbone - Lecture 4</a></h1>

			</header>
			<nav id="nav">
				<ul>
					<li><a href="#one" class="active">The Social API</a></li>
					<li><a href="#two">Messaging Between Views</a></li>
					<li><a href="#three">Refactoring</a></li>
					<li><a href="#four">Handlebars</a></li>
				</ul>
				<img src="http://www.avenuecode.com/wp-content/themes/ac-site/images/white-logo.png" alt="">
			</nav>
			<footer>
			</footer>
		</section>

		<!-- Main -->
		<div id="main">

			<div class="container">
				<img class="logo-big" src="./images/backbone.png">
			</div>

			<!-- One -->
			<section id="one">
				<div class="container">

					<header class="major">
						<h2>The Social API</h2>
					</header>
					
					<p align="justify">
						On the previous lectures we worked with Views, Models, Collections and the Router, and worked on linking those features together to display the four kind of relationships we have.
					</p>

					<p align="justify">
						Now we are going to create <b>events</b> and <b>triggers</b> to link our Views to the API though the Models <b>save</b> properties. For that we have to create a new kind of model, that we are going to call the <b>FriendshipModel</b>.
					</p>

					<header>
						<h4>The FriendshipModel</h4>
					</header>

					<p align="justify">
						<b>Friendships</b> are a kind of object on its own, which connect two <b>Users</b> objects. When we request the <b>Friendships</b> from our API, it gives us an array of objects like this:
					</p>

<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #f8f8f2">{</span>
    <span style="color: #f92672">&quot;__v&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span>
    <span style="color: #f92672">&quot;vipUserRequester&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #66d9ef">false</span><span style="color: #f8f8f2">,</span>
    <span style="color: #f92672">&quot;vipUserRequested&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #66d9ef">false</span><span style="color: #f8f8f2">,</span>
    <span style="color: #f92672">&quot;blockUserRequester&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #66d9ef">false</span><span style="color: #f8f8f2">,</span>
    <span style="color: #f92672">&quot;blockUserRequested&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #66d9ef">false</span><span style="color: #f8f8f2">,</span>
    <span style="color: #f92672">&quot;status&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span>
    <span style="color: #f92672">&quot;_id&quot;</span><span style="color: #f8f8f2">:{</span>
        <span style="color: #f92672">&quot;userRequester&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">&quot;55c9ee483612b9302993ad25&quot;</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f92672">&quot;userRequested&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">&quot;55cc91bb7bfc0ce845e7824c&quot;</span>
    <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
<div class="ac-caption">An object of the <b>Friendship</b> kind.</div>					

					<p align="justify">
						The user listings we used on Exercise 10 are actually some backend work to select the users listend on these <b>friendships</b> objects.
					</p>

					<p align="justify">
						Now lets take a look on the friendship <b>routes</b> provided by the backend. The word 'friendships' does not appear because it is appended by the route adding on <b>server.js</b>: <b>app.use('/friendships', friendship)</b>.
					</p>

<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listAllFriendships</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/me&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listMyFriendships</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/requests&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listFriendshipsRequests</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/requested&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">listFriendshipsRequested</span><span style="color: #f8f8f2">);</span>

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/:friendId&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">get</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">getFriendship</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">post</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">inviteFriend</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">put</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">acceptFriend</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #66d9ef">delete</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">rejectFriend</span><span style="color: #f8f8f2">);</span>
 
<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/:friendId/vip&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">post</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">setVip</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #66d9ef">delete</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">unsetVip</span><span style="color: #f8f8f2">);</span>
 

<span style="color: #a6e22e">router</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">route</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&#39;/:friendId/block&#39;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #a6e22e">post</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">setBlock</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">.</span><span style="color: #66d9ef">delete</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">auth</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isAuthenticated</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">friendshipController</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">unsetBlock</span><span style="color: #f8f8f2">);</span>
</pre></div>
<div class="ac-caption">Backend friendship routes.</div>

					<p align="justify">
						We created some paths to allow the retrieve of <b>user</b> objects instead of the <b>friendships</b>, but the <b>friendships/:friendId</b> still responds for the friendship <b>CRUD</b> map.
					</p>

					<p align="justify">
						You can test all the <b>get</b> routes by simply opening the <b>url</b> on your browser: try <b>/friendships</b> and <b>/friendships/me</b>.
					</p>

					<header>
						<h4>The Friendship Model</h4>
					</header>

					<p align="justify">
						Now that we have a backend path  listing, we will create a Model to interact with them.
					</p>

<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">var</span> <span style="color: #a6e22e">FriendshipModel</span> <span style="color: #f92672">=</span> <span style="color: #a6e22e">Backbone</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Model</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">extend</span><span style="color: #f8f8f2">({</span>
  <span style="color: #a6e22e">urlRoot</span><span style="color: #f92672">:</span> <span style="color: #e6db74">&#39;/friendships&#39;</span><span style="color: #f8f8f2">,</span>
  <span style="color: #a6e22e">sync</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">method</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">model</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">options</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
    <span style="color: #a6e22e">options</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">(</span><span style="color: #a6e22e">options</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">{});</span>
    <span style="color: #66d9ef">switch</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">method</span><span style="color: #f8f8f2">){</span>
      <span style="color: #66d9ef">case</span> <span style="color: #e6db74">&#39;create&#39;</span><span style="color: #f92672">:</span>
      <span style="color: #a6e22e">options</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">url</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">this</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">urlRoot</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;/&#39;</span> <span style="color: #f92672">+</span> <span style="color: #a6e22e">model</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">attributes</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">friendID</span><span style="color: #f8f8f2">;</span>
      <span style="color: #66d9ef">break</span><span style="color: #f8f8f2">;</span>
    <span style="color: #f8f8f2">}</span>
    <span style="color: #66d9ef">return</span> <span style="color: #a6e22e">Backbone</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">sync</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">method</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">model</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">options</span><span style="color: #f8f8f2">);</span>
  <span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">});</span>
</pre></div>
<div class="ac-caption">The FriendshipModel.</div>

					<p align="justify">
						Notice that we customized the <b>sync</b> method to add some data (the <b>friendID</b>) when we are creating a new frienship. This is for matching our API, which requires the friend id for handling all the frienships actions.
					</p>
					<p>
						By default, the Model does not add the <b>id</b> when creating an object. The <b>friendship</b> object is an exception because actually the id we are sending is not the one for the entity itself, but for informing which user we want to manage the friendship with.
					</p>

					<header>
						<h4>Exercise 11</h4>
					</header>

					<p>
						You can keep working on <b>exercise10.html</b> because now your work is on your <b>socialnetwork.js</b> file.
					</p>

					<ol>
						<li>Add the <b>events</b> object to the <b>AvailableUsersView</b>. Make the <b>click</b> on the <b>.inviteFriend</b> link fire a method that creates a new friendship and saves it. 
						</li>
						<li>The friendship related collections now should use the FriendshipModel (for the special <b>sync</b> to be called).</li>
						<li>Notice you will also have to set one property on the model before saving it for the <b>sync</b> method to work when creating a friendship.</li>
						<li>Upon a succesful saving, issue a <b>fetch</b> on both <b>AvailableUsersView</b> for it to reflect the new friendship configuration.</li>
						<li>Repeat the process with the <b>.acceptFriend</b> link on the  <b>FriendsRequestsView</b>.</li>
				</ol>

				</div>
			</section>

			<section id="two">
				<div class="container">

					<header class="major">
						<h2>Messaging Between Views</h2>
					</header>
							
				</div>
			</section>

			<section id="three">
				<div class="container">

					<header class="major">
						<h2>Refactoring</h2>
					</header>
							
				</div>
			</section>

			<section id="four">
				<div class="container">

					<header class="major">
						<h2>Handlebars</h2>
					</header>
							
				</div>
			</section>


		
		</div>

		<!-- Footer -->
		<section id="footer">
			<div class="container">
				<ul class="copyright">
					<li>&copy; Avenue Code. All rights reserved.</li>
					<li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
				</ul>
			</div>
		</section>

	</div>
</body>
</html>